version: "3.1"

stories:

# Start the conversation with a greeting.
- story: greet
  steps:
  - intent: greet
  - action: utter_greet
  - checkpoint: conversation_started

# Start the conversation without a greeting.
- story: start without greeting
  steps:
  - checkpoint: conversation_started

# In the first round, the user must provide a location.
- story: first round weather 1
  steps:
  - checkpoint: conversation_started
  - intent: ask_weather
  - action: utter_ask_location
  - intent: inform_location
    entities:
    - city: London
  - slot_was_set:
    - user_location: London
  - action: action_request_location
  - slot_was_set:
    - mapped_location: London (UK)
    - mapped_latitude: 51.5073219
    - mapped_longitude: -0.1276474
  - action: utter_location_mapping
  - action: action_request_weather
  - slot_was_set:
    - weather: cloudy
    - temperature: 10.0
    - cloudiness: 90.0
    - wind_speed: 4.0
    - temperature_unit: °C
  - action: utter_weather
  - checkpoint: first_round_done

# In the second round, the user can provide another location.
- story: second round weather 1
  steps:
  - checkpoint: another_round
  - intent: ask_weather
  - action: utter_ask_location
  - intent: inform_location
    entities:
    - city: Beijing
  - slot_was_set:
    - user_location: Beijing
  - action: action_request_location
  - slot_was_set:
    - mapped_location: Beijing (CN)
    - mapped_latitude: 39.906217
    - mapped_longitude: 116.3912757
  - action: utter_location_mapping
  - action: action_request_weather
  - slot_was_set:
    - weather: cloudy
    - temperature: 10.0
    - cloudiness: 90.0
    - wind_speed: 4.0
    - temperature_unit: °C
  - action: utter_weather
  - checkpoint: second_round_done

# In the first round, the user must provide a location.
- story: first round weather 2
  steps:
  - checkpoint: conversation_started
  - intent: ask_weather_in_location
    entities:
    - city: London
  - slot_was_set:
    - user_location: London
  - action: action_request_location
  - slot_was_set:
    - mapped_location: London (UK)
    - mapped_latitude: 51.5073219
    - mapped_longitude: -0.1276474
  - action: utter_location_mapping
  - action: action_request_weather
  - slot_was_set:
    - weather: cloudy
    - temperature: 10.0
    - cloudiness: 90.0
    - wind_speed: 4.0
    - temperature_unit: °C
  - action: utter_weather
  - checkpoint: first_round_done

# In the second round, the user can provide another location.
- story: second round weather 2
  steps:
  - checkpoint: another_round
  - intent: ask_weather_in_location
    entities:
    - city: Beijing
  - slot_was_set:
    - user_location: Beijing
  - action: action_request_location
  - slot_was_set:
    - mapped_location: Beijing (CN)
    - mapped_latitude: 39.906217
    - mapped_longitude: 116.3912757
  - action: utter_location_mapping
  - action: action_request_weather
  - slot_was_set:
    - weather: cloudy
    - temperature: 10.0
    - cloudiness: 90.0
    - wind_speed: 4.0
    - temperature_unit: °C
  - action: utter_weather
  - checkpoint: second_round_done

# In the first round, the user must provide a location.
- story: first round temperature
  steps:
  - checkpoint: conversation_started
  - intent: ask_temperature
  - action: utter_ask_location
  - intent: inform_location
    entities:
    - city: London
  - slot_was_set:
    - user_location: London
  - action: action_request_location
  - slot_was_set:
    - mapped_location: London (UK)
    - mapped_latitude: 51.5073219
    - mapped_longitude: -0.1276474
  - action: utter_location_mapping
  - action: action_request_weather
  - slot_was_set:
    - weather: cloudy
    - temperature: 10.0
    - cloudiness: 90.0
    - wind_speed: 4.0
    - temperature_unit: °C
  - action: utter_temperature
  - checkpoint: first_round_done

# In the second round, the temperature should be provided for the same location as in the first round.
- story: second round temperature
  steps:
  - checkpoint: another_round
  - intent: ask_temperature
  - action: utter_temperature
  - checkpoint: second_round_done

# In the first round, the user must provide a location.
- story: first round cloudiness
  steps:
  - checkpoint: conversation_started
  - intent: ask_cloudiness
  - action: utter_ask_location
  - intent: inform_location
    entities:
    - city: London
  - slot_was_set:
    - user_location: London
  - action: action_request_location
  - slot_was_set:
    - mapped_location: London (UK)
    - mapped_latitude: 51.5073219
    - mapped_longitude: -0.1276474
  - action: utter_location_mapping
  - action: action_request_weather
  - slot_was_set:
    - weather: cloudy
    - temperature: 10.0
    - cloudiness: 90.0
    - wind_speed: 4.0
    - temperature_unit: °C
  - action: utter_cloudiness
  - checkpoint: first_round_done

# In the second round, the cloudiness should be provided for the same location as in the first round.
- story: second round cloudiness
  steps:
  - checkpoint: another_round
  - intent: ask_cloudiness
  - action: utter_cloudiness
  - checkpoint: second_round_done

# In the first round, the user must provide a location.
- story: first round wind speed
  steps:
  - checkpoint: conversation_started
  - intent: ask_wind_speed
  - action: utter_ask_location
  - intent: inform_location
    entities:
    - city: London
  - slot_was_set:
    - user_location: London
  - action: action_request_location
  - slot_was_set:
    - mapped_location: London (UK)
    - mapped_latitude: 51.5073219
    - mapped_longitude: -0.1276474
  - action: utter_location_mapping
  - action: action_request_weather
  - slot_was_set:
    - weather: cloudy
    - temperature: 10.0
    - cloudiness: 90.0
    - wind_speed: 4.0
    - temperature_unit: °C
  - action: utter_wind_speed
  - checkpoint: first_round_done

# In the second round, the wind speed should be provided for the same location as in the first round.
- story: second round wind speed
  steps:
  - checkpoint: another_round
  - intent: ask_wind_speed
  - action: utter_wind_speed
  - checkpoint: second_round_done

# Start another round directly after the former one.
- story: another round without chit chat
  steps:
  - checkpoint: first_round_done
  - checkpoint: another_round

# If the user thanks or affirms, the user is asked for mor assistance.
- story: ask for more assistance
  steps:
  - checkpoint: first_round_done
  - or:
    - intent: affirm
    - intent: thanks
  - action: utter_welcome
  - action: utter_anything_else
  - checkpoint: ask_anything_else

# Just go on without confirmation.
- story: another round without confirmation
  steps:
  - checkpoint: ask_anything_else
  - checkpoint: another_round

# If the user accepts, another round can be started.
- story: accept another round
  steps:
  - checkpoint: ask_anything_else
  - intent: affirm
  - action: utter_opener
  - checkpoint: another_round

# If the user denies, the conversation is ended.
- story: deny another round
  steps:
  - checkpoint: ask_anything_else
  - intent: deny
  - action: utter_no_problem
  - action: action_session_start

# Restart the bot after two rounds.
- story: another round without chit chat 2
  steps:
  - checkpoint: second_round_done
  - action: utter_anything_else
  - action: action_session_start

# TODO: Implement fallback story and user question: "What can you do?"